<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Accueil — EstheConnect</title>

  <!-- ✅ On conserve tous tes CSS existants pour garder EXACTEMENT le même style/couverture -->
  <link rel="stylesheet" href="/EstheConnect/assets/css/style.css"/>
  <link rel="stylesheet" href="/EstheConnect/assets/site.css"/>
  <link rel="stylesheet" href="/EstheConnect/style.css"/>
  <link rel="stylesheet" href="assets/css/style.css"/>
  <link rel="stylesheet" href="assets/site.css"/>
  <link rel="stylesheet" href="style.css"/>

  <style>
    :root{--ink:#111;--rose:#e6b0ba;--gold:#c8a64b;--bg:#0c0c0d}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;background:var(--bg);color:#eee}
    .wrap{max-width:1100px;margin:0 auto;padding:0 16px}
    a{color:inherit}

    /* 🪄 Badge convertisseur */
    .currency-widget{position:fixed;right:12px;bottom:12px;z-index:9999;background:#111a;border:1px solid #222;padding:10px 12px;border-radius:14px;backdrop-filter:blur(6px)}
    .currency-widget label{font-size:12px;opacity:.8;margin-right:6px}
    .currency-widget select{background:#000;border:1px solid #333;color:#fff;border-radius:10px;padding:6px}
    .currency-note{font-size:11px;opacity:.7;margin-top:6px}

    /* Sections utilitaires optionnelles (non intrusif si déjà présent dans tes CSS) */
    section{padding:28px 0}
    .muted{opacity:.8}
    .card{background:#111;border:1px solid #222;border-radius:18px;padding:16px}
    .tag{display:inline-block;background:#1a1a1a;border:1px solid #333;border-radius:999px;padding:4px 10px;font-size:12px}
  </style>
</head>
<body>

  <!-- ⛑️ COUVERTURE / HERO : LAISSÉE INTACTE (aucune modif structurelle). -->
  <header id="hero">
    <div class="wrap">
      <div class="card" style="display:flex;gap:18px;align-items:center">
        <picture style="flex:0 0 120px">
          <!-- 📸 On garde src ET srcset sera ajouté automatiquement via JS si manquant -->
          <img src="assets/img/hero.jpg" alt="EstheConnect" width="120" height="120" style="border-radius:16px;object-fit:cover" loading="lazy">
        </picture>
        <div>
          <h1 style="margin:0 0 6px;font-size:28px;letter-spacing:.2px">EstheConnect Center</h1>
          <p class="muted" style="margin:0">Plateforme esthétique haut de gamme — Tunisie & Turquie</p>
          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
            <span class="tag">Chirurgie</span>
            <span class="tag">Dentaire</span>
            <span class="tag">Greffe capillaire</span>
            <span class="tag">Médecine esthétique</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- 🧾 SECTION PRIX (on applique −50€ sur chaque prix comme demandé) -->
  <section id="prix" class="wrap">
    <h2>Tarifs — exemples</h2>
    <div class="card">
      <ul style="list-style:none;padding:0;margin:0;display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px">
        <li>
          <strong>Lifting mannequin</strong>
          <div class="muted">Déroulement, anesthésie générale, 2–3h</div>
          <div class="price" data-price-eur="2350">€ 2 350</div>
        </li>
        <li>
          <strong>Lifting cervico‑facial</strong>
          <div class="muted">2–4h, 1 nuit clinique</div>
          <div class="price" data-price-eur="2450">€ 2 450</div>
        </li>
        <li>
          <strong>Lifting + lipofilling</strong>
          <div class="muted">Greffe de graisse autologue</div>
          <div class="price" data-price-eur="2350">€ 2 350</div>
        </li>
        <li>
          <strong>Lifting complet</strong>
          <div class="muted">Plan complet personnalisé</div>
          <div class="price" data-price-eur="2850" data-range-max-eur="3450">€ 2 850 – 3 450</div>
        </li>
      </ul>
      <p class="currency-note">Affichage converti automatiquement selon la devise choisie (base EUR).</p>
    </div>
  </section>

  <!-- 📞 CONTACT (WhatsApp & Email cliquables) -->
  <section id="contact">
    <div class="wrap card">
      <h2>Contact</h2>
      <p>WhatsApp : <a href="https://wa.me/21628296239" target="_blank" rel="noopener">+216 28 296 239</a><br/>
         Email : <a href="mailto:aboprof.bm2@gmail.com">aboprof.bm2@gmail.com</a></p>
    </div>
  </section>

  <!-- 💱 Widget sélection devise -->
  <div class="currency-widget" aria-live="polite">
    <label for="currencySelect">Devise</label>
    <select id="currencySelect">
      <option value="EUR">EUR — €</option>
      <option value="TND">TND — د.ت</option>
      <option value="TRY">TRY — ₺</option>
      <option value="USD">USD — $</option>
      <option value="GBP">GBP — £</option>
      <option value="MAD">MAD — د.م.</option>
    </select>
    <div class="currency-note" id="currencyInfo">Taux du jour (source: exchangerate.host)</div>
  </div>

  <!-- =============================== -->
  <!-- 🚀 JS UTILITAIRE INTÉGRÉ       -->
  <!-- =============================== -->
  <script>
  ;(function(){
    // 1) 🔁 Remplacement automatique "src" -> pattern "srcset" (sans rien casser)
    function ensureSrcset(img){
      if(!img || img.tagName !== 'IMG') return;
      if(!img.getAttribute('src')) return;
      if(!img.hasAttribute('srcset')){
        const s = img.getAttribute('src').trim();
        if(s){ img.setAttribute('srcset', s + ' 1x'); }
      }
      if(!img.hasAttribute('loading')){ img.setAttribute('loading','lazy'); }
      if(!img.hasAttribute('decoding')){ img.setAttribute('decoding','async'); }
    }
    function walkAndPatchSrcset(root){
      const imgs = root.querySelectorAll('img');
      imgs.forEach(ensureSrcset);
    }
    document.addEventListener('DOMContentLoaded', function(){
      walkAndPatchSrcset(document);
      const mo = new MutationObserver(muts=>{
        muts.forEach(m=>{
          m.addedNodes && m.addedNodes.forEach(n=>{
            if(n.nodeType===1){
              if(n.tagName==='IMG') ensureSrcset(n);
              else walkAndPatchSrcset(n);
            }
          });
        });
      });
      mo.observe(document.documentElement,{childList:true,subtree:true});
    });

    // 2) 💱 Auto‑conversion de devises (base EUR)
    const STORE_KEY = 'estheconnect.currency';
    const RATES_KEY = 'estheconnect.rates';
    const RATES_TTL_MS = 1000*60*60*12; // 12h

    const select = document.getElementById('currencySelect');
    const info   = document.getElementById('currencyInfo');

    const preferred = localStorage.getItem(STORE_KEY) || guessCurrency();
    if(select && preferred){ select.value = preferred; }

    select && select.addEventListener('change', ()=>{
      localStorage.setItem(STORE_KEY, select.value);
      convertAllPrices();
    });

    function guessCurrency(){
      try{
        const loc = (Intl.DateTimeFormat().resolvedOptions().locale||'').toUpperCase();
        if(loc.includes('FR-BE') || loc.includes('FR') || loc.includes('BE') || loc.includes('EU')) return 'EUR';
        if(loc.includes('TN')) return 'TND';
        if(loc.includes('TR')) return 'TRY';
        if(loc.includes('GB')) return 'GBP';
        if(loc.includes('US') || loc.includes('EN-US')) return 'USD';
      }catch(e){}
      return 'EUR';
    }

    async function getRates(){
      try{
        const cached = JSON.parse(localStorage.getItem(RATES_KEY)||'null');
        if(cached && (Date.now()-cached.timestamp < RATES_TTL_MS)){
          return cached.data;
        }
      }catch(e){}
      try{
        const res = await fetch('https://api.exchangerate.host/latest?base=EUR');
        const data = await res.json();
        if(data && data.rates){
          localStorage.setItem(RATES_KEY, JSON.stringify({timestamp:Date.now(), data:data.rates}));
          return data.rates;
        }
      }catch(e){ console.warn('Rates fetch failed, using fallback', e); }
      return {TND:3.40, TRY:35.0, USD:1.08, GBP:0.84, MAD:10.7, EUR:1};
    }

    function formatCurrency(val, code){
      try{ return new Intl.NumberFormat(undefined, {style:'currency', currency:code}).format(val); }
      catch(e){
        const sym = code==='TND'?'د.ت':code==='TRY'?'₺':code==='USD'?'$':code==='GBP'?'£':code==='MAD'?'د.م.':'€';
        return sym+' '+val.toFixed(0);
      }
    }

    function parseEuroText(txt){
      const m = txt.replace(/\u00A0/g,' ').match(/€\s*([0-9][0-9 .\u00A0]*)/);
      if(!m) return null;
      const num = parseFloat(m[1].replace(/[ .\u00A0]/g,''));
      return isFinite(num) ? num : null;
    }

    function setConvertedText(el, eur, currency, rates){
      if(!isFinite(eur)) return;
      const rate = rates[currency] || 1;
      const conv = eur * rate;
      const converted = formatCurrency(conv, currency);
      const base = el.getAttribute('data-original-text') || el.textContent.trim();
      if(!el.hasAttribute('data-original-text')) el.setAttribute('data-original-text', base);
      const max = parseFloat(el.getAttribute('data-range-max-eur'));
      let extra = '';
      if(isFinite(max)){
        const convMax = formatCurrency(max * rate, currency);
        extra = ' – ' + convMax;
      }
      el.textContent = base.replace(/\(≈.*\)$/,'').trim() + ' (≈ ' + converted + extra + ')';
    }

    async function convertAllPrices(){
      const currency = (select && select.value) || 'EUR';
      const rates = await getRates();
      document.querySelectorAll('[data-price-eur]').forEach(el=>{
        const eur = parseFloat(el.getAttribute('data-price-eur'));
        setConvertedText(el, eur, currency, rates);
      });
      document.querySelectorAll('.price:not([data-price-eur])').forEach(el=>{
        const eur = parseEuroText(el.textContent||'');
        if(eur!=null) setConvertedText(el, eur, currency, rates);
      });
      info && (info.textContent = currency==='EUR' ? 'Affichage en EUR' : 'Conversion en '+currency+' (base EUR)');
    }

    document.addEventListener('DOMContentLoaded', convertAllPrices);
  })();
  </script>

</body>
</html>
